<!--包含头部文件-->
{include file="public/header" /}
<div class="cl pd-5 bg-1 bk-gray mt-20"> <h1>商户入驻申请</h1></div>
<article class="page-container">
	<form class="form form-horizontal"  method="post" action="">
	基本信息：
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商户名称：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="name" name="name">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>所属城市：</label>
			<div class="formControls col-xs-8 col-sm-2"> 
				<span class="select-box">
				<select name="city_id" id="city" class="select cityId" required>

					{volist name="cityp" id="vo"}
					<option value="{$vo.id}">{$vo.name}</option>
					{/volist}
				</select>
				</span>
			</div>
			<div class="formControls col-xs-8 col-sm-2">
				<span class="select-box">
				<select name="se_city_id" id="se_city" class="select se_city_id" >

				</select>
				</span> 
			</div>
		</div>
		
		<div class="row cl">
              <label class="form-label col-xs-4 col-sm-2">缩略图：</label>
              <div class="formControls col-xs-8 col-sm-9">
                <input id="file_upload"  name="file_upload" type="file" multiple="true" >
                <img style="display: none" id="upload_org_code_img" src="" width="150" height="150">

                <input id="file_upload_image" name="logo" type="hidden" multiple="true" value="">
              </div>
        </div>
        <div class="row cl">
              <label class="form-label col-xs-4 col-sm-2">营业执照：</label>
              <div class="formControls col-xs-8 col-sm-9">
                <input id="file_upload_other"  type="file" multiple="true" >
                <img style="display: none" id="upload_org_code_img_other" src="" width="150" height="150">
                <input id="file_upload_image_other" name="licence_logo" type="hidden" multiple="true" value="">
              </div>
        </div>
        
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商户介绍：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor1"  type="text/plain" name="description" value=" " style="width:80%;height:300px;"></script>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">银行账号:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_info">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">开户行名称:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">开户行姓名:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_user">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">法人:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="faren">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">法人电话:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="faren_tel">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>邮箱：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="email">
			</div>
		</div>
		总店信息：
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>电话:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="tel">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">联系人:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="contact">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>所属分类：</label>
			<div class="formControls col-xs-8 col-sm-3"> <span class="select-box">
				<select name="category_id" class="select categoryId" required>

					{volist name="categoryPdata" id="vo"}
					<option value="{$vo.id}">{$vo.name}</option>
					{/volist}
				</select>
				</span> 
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">所属子类：</label>
			<div class="formControls col-xs-8 col-sm-3 skin-minimal">
				<div id="se_category" class="check-box se_category_id">

				</div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商户地址：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="address">
			</div>

		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">营业时间:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="open_time">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">门店简介：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor"  type="text/plain" name="content" style="width:80%;height:300px;"></script> 
			</div>
		</div>

		账号信息：
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>用户名:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="username">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>密码:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="password" class="input-text" value="" placeholder="" id="password" name="password">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>确认密码:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="password" class="input-text" value="" placeholder="" id="" name="repassword">
			</div>
		</div>
		
		<div class="row cl" id="submit">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button  class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 申请</button>	
			</div>
		</div>
	</form>
</article>

<!--包含尾部文件-->
{include file="public/footer" /}
<script type="text/javascript" src="__O2O__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__O2O__/uploadify/jquery.uploadify.min.js"></script>


<script type="text/javascript" src="__O2O__/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__O2O__/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__O2O__/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<!--分配编辑器-->
<script>
	//editor
$(function(){
	var ue = UE.getEditor('editor');
	var ue1 = UE.getEditor('editor1');
});

    //上传插件uploadify配置
    $(function() {
        $("#file_upload").uploadify({
            height        : 30,
            swf           : '/static/o2o/uploadify/uploadify.swf',
            uploader      : '/bis/api/image',
            width         : 120,
            buttonText    :'图片上传',
			fileObjName   :'file',//这必须输，TP5按name识别的，这个就name
			fileTypeExts  :'*.gif;*.jpg;*.png',
			onUploadSuccess:function (file,data,response) {
                console.log(file);
                console.log('data:'+data);
                console.log('res:'+response);
                var data=JSON.parse(data)
                if(data.code == 1){

                    $('#file_upload_image').val('/images/'+data.comment);
                    $('#upload_org_code_img').attr("src",'__STATIC__/images/'+data.comment);
                    $('#upload_org_code_img').css("display","block");

				}else {
                    layer.msg( data.comment,{icon:2,time:2000});
				}

            }
        });
        $("#file_upload_other").uploadify({
            height        : 30,
            swf           : '/static/o2o/uploadify/uploadify.swf',
            uploader      : '/bis/api/image',
            width         : 120,
            buttonText    :'图片上传',
            fileObjName   :'file',//这必须输，TP5按name识别的，这个就name
            fileTypeExts  :'*.gif;*.jpg;*.png',
            onUploadSuccess:function (file,data,response) {
                console.log(file);
                console.log('data:'+data);
                console.log('res:'+response);
                var data=JSON.parse(data)
                if(data.code == 1){

                    $('#file_upload_image_other').val('/images/'+data.comment);
                    $('#upload_org_code_img_other').attr("src",'__STATIC__/images/'+data.comment);
                    $('#upload_org_code_img_other').css("display","block");

                }else {
                    layer.msg( data.comment,{icon:2,time:2000});
                }

            }
        });
    });

</script>
<script>

	//分类相关二级内容
	$(".categoryId").change(function () {
        $.post("/bis/api/category",
            {

                pid:$(this).val(),

            },
            function(result){

        //        $("#se_city").append("{vlist name='se_city' id='vo'}<option value='{$vo.id}'>{$vo.name}</option>{/volist}");
           if(result.code == 1){
               var data=result.data;
               //alert(data.length);
			   var secategory_html='';
               for (var i=0;i<data.length;i++)
               {
                  // document.write(data[i]['name'] + "<br>");

				  secategory_html += "<input class='skin-minimal input' name='se_category_id[]' value="+data[i]['id']+" type='checkbox'>"+data[i]['name']+"";

               }
               //alert(111);
               $('#se_category').html(secategory_html);

           }else {

               layer.msg('该分类下无子分类',{icon:2,time:2000});
               $('#se_category').html('<p>无子分类</p>');
		   }
            },'json');
    });

    //城市相关二级内容
    $(".cityId").change(function () {
        $.post("/bis/api/city",
            {
                //  pid:$("#city").val(),
                pid:$(this).val(),

            },
            function(result){

                //        $("#se_city").append("{vlist name='se_city' id='vo'}<option value='{$vo.id}'>{$vo.name}</option>{/volist}");
                if(result.code == 1){
                    var data=result.data;
                    //alert(data.length);
                    var secity_html='';
                    for (var i=0;i<data.length;i++)
                    {
                        // document.write(data[i]['name'] + "<br>");

                        secity_html += "<option name='se_city_id' value='"+data[i]['id']+"'>"+data[i]['name']+"</option>";

                    }
                    //alert(111);
                    $('#se_city').html(secity_html);

                }else {

                    layer.msg('后台数据出错',{icon:2,time:2000});
                }
            },'json');
    });
</script>
<script type="text/javascript">
    $(function(){
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $(".form").validate({
            rules:{

//                name:{
//                    required:true,
//                    remote: {
//                        url: "/bis/api/nameV",     //后台处理程序
//                        type: "post",               //数据发送方式
//                        dataType: "json",           //接受数据格式
//                        data: {                     //要传递的数据
//                            name: function() {
//                                return $("#name").val();
//                              },
//                            },
//                        }
//                },

				email:{
                    required:true,
                    email:true,
                },
				tel:{
                    required:true,
                    number:true,
				},
				username:{
                    required:true,
				},
                password:{
                    minlength: 5,
                    required:true,
                },
                repassword:{
                    required:true,
                    equalTo:"#password",
                },
            },


            messages:{
                name:{
                    required:"输入啊大哥",
                   // remote:"已存在相同名称的分类，请修正此字段",
                }
            },

            onfocusout:true,
            onkeyup:true,
            focusCleanup:false,
            focusInvalid:true,
            success:"valid",
            submitHandler:function(form){
                $('#submit').css('display','none')
                $(form).ajaxSubmit({
                    type: 'post',
                    url: "/bis/register/save",
                    success: function(resdata){
                        if(resdata.code == '1') {

                            layer.msg('添加数据成功,正在跳转！',{icon:1,time:1000});

                       //     history.go(-1);
                            setTimeout(function(){window.location.href = "/bis/register/waiting?id="+resdata.msg;},1000);


                        }else {
                            $('#submit').css('display','block')
                            layer.msg(resdata.msg,{icon:2,time:1000});
                        }


                    },
                    error: function(XmlHttpRequest, textStatus, errorThrown){
                        $('#submit').css('display','block')
                        layer.msg('ajax连接后台出错',{icon:2,time:3000});

                    }
                });


            }
        });

    });
</script>

</body>
</html>